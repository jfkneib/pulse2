#!/bin/sh
#
# Launch all postinstall scripts
#


# Functions which can be intersting in the postinst scripts

. /opt/lib/libpostinst.sh

# 1st execute the global preinst
if [ -r /revoinfo/preinst ] ;then
    echo "*** Executing global preinst script ***"
    /bin/revosendlog 6
    . /revoinfo/preinst
    /bin/revosendlog 7
fi

# Image postinst or system postinst ?
if grep -q revosavedir /proc/cmdline ;then
    # then the local image postinst
    if [ -r /revosave/postinst ] ;then
	echo "*** Executing local image postinst script ***"
	/bin/revosendlog 6
	set -v
	. /revosave/postinst
	set +v
	/bin/revosendlog 7
    fi
else
# or the local postinst
    if [ -r /revoinfo/$MAC/postinst ] ;then
	echo "*** Executing local postinst script ***"
        /bin/revosendlog 6
	set -v
	. /revoinfo/$MAC/postinst
	set +v
	/bin/revosendlog 7
    fi
fi

# and finally the global postinst
if [ -r /revoinfo/postinst ] ;then
    echo "*** Executing global postinst script ***"
    /bin/revosendlog 6
    . /revoinfo/postinst
    /bin/revosendlog 7
fi
